<!DOCTYPE html>
<html>
<head><script src="/livereload.js?port=1313&mindelay=10&v=2" data-no-instant defer></script>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Validating composite models with knockout validation - Jef Claes</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta itemprop="name" content="Validating composite models with knockout validation">
<meta itemprop="description" content="When you use knockout validation to extend observables with validation rules, it will add a few functions to these observables - the most important ones being; error and isValid. You can use these functions to verify if any of the validation rules were violated, and to extract an error message.
To extract all of the error messages out of a composite model, you can use a grouping function.
function BookingModel() { var self = this; self.">
<meta itemprop="datePublished" content="2013-05-20T17:02:00&#43;02:00" />
<meta itemprop="dateModified" content="2013-05-20T17:02:00&#43;02:00" />
<meta itemprop="wordCount" content="503">



<meta itemprop="keywords" content="," /><meta property="og:title" content="Validating composite models with knockout validation" />
<meta property="og:description" content="When you use knockout validation to extend observables with validation rules, it will add a few functions to these observables - the most important ones being; error and isValid. You can use these functions to verify if any of the validation rules were violated, and to extract an error message.
To extract all of the error messages out of a composite model, you can use a grouping function.
function BookingModel() { var self = this; self." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/2013/05/validating-composite-models-with-knockout-validation/" />
<meta property="article:published_time" content="2013-05-20T17:02:00+02:00" />
<meta property="article:modified_time" content="2013-05-20T17:02:00+02:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Validating composite models with knockout validation"/>
<meta name="twitter:description" content="When you use knockout validation to extend observables with validation rules, it will add a few functions to these observables - the most important ones being; error and isValid. You can use these functions to verify if any of the validation rules were violated, and to extract an error message.
To extract all of the error messages out of a composite model, you can use a grouping function.
function BookingModel() { var self = this; self."/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="http://localhost:1313/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="http://localhost:1313/css/main.css" />

        <link id="dark-scheme" rel="stylesheet" type="text/css" href="http://localhost:1313/css/dark.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="http://localhost:1313/js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="http://localhost:1313/">
				<img src="https://image.freepik.com/free-vector/young-man-head-with-beard-avatar-character_24877-36786.jpg" alt="Jef Claes" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="http://localhost:1313/">Jef Claes</a></h1>
	<div class="site-description"><p>On software and life</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/jefclaes" title="Github"><i data-feather="github"></i></a></li><li><a href="/index.xml" title="RSS"><i data-feather="rss"></i></a></li></ul>
		</nav></div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/post">All posts</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">20</span>
							<span class="rest">May 2013</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">Validating composite models with knockout validation</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>When you use <a href="https://github.com/Knockout-Contrib/Knockout-Validation">knockout
validation</a> to
extend observables with validation rules, it will add a few functions to
these observables - the most important ones being; error and isValid.
You can use these functions to verify if any of the validation rules
were violated, and to extract an error message.</p>
<p>To extract all of the error messages out of a composite model, you can
use a grouping function.</p>
<pre><code>function BookingModel() {      
    var self = this;
   
    self.contact = new ContactModel();
    self.departure = new DepartureModel();
   
    self.isValid = function() {
        return self.contact.isValid() &amp;&amp; self.departure.isValid();
    };
   
    self.validate = function() {                           
        if (!self.isValid()) {
            var errors = ko.validation.group(self);                           
            errors.showAllMessages();
        
            return false;          
        }

        return true;
    };                    
}

function DepartureModel() {
    this.street = ko.observable('').extend({ required: true });
    this.houseNumber = ko.observable('').extend({ required: true });
    this.city = ko.observable('').extend({ required: true });
    this.time = ko.observable('').extend({ required: true });            
    
    this.isValid = function() {
        return 
            this.street.isValid() &amp;&amp;
            this.houseNumber.isValid() &amp;&amp;
            this.city.isValid() &amp;&amp;
            this.time.isValid();                
    };
}

function ContactModel() {
    this.firstName = ko.observable('').extend({ required: true });
    this.lastName = ko.observable('').extend({ required: true });
    this.phoneNumber = this.firstName = ko.observable('').extend({ required: true });
    this.email = ko.observable('').extend({ required: true });   

    this.isValid = function() {
        return 
            this.firstName.isValid() &amp;&amp;
            this.lastName.isValid() &amp;&amp;
            this.phoneNumber.isValid() &amp;&amp;
            this.email.isValid();                
    };    
}
</code></pre>
<p>This is what my first attempt looked like. A little later I discovered
that you can get rid of these boilerplate functions on the composite
model by applying the validatedObservable function instead.</p>
<pre><code>ko.applyBindings(ko.validatedObservable(new BookingModel()));

ko.validatedObservable = function (initialValue) {
    if (!exports.utils.isObject(initialValue)) { 
        return ko.observable(initialValue).extend({ validatable: true }); }

    var obsv = ko.observable(initialValue);
    obsv.errors = exports.group(initialValue);
    obsv.isValid = ko.computed(function () {
        return obsv.errors().length === 0;
    });

    return obsv;
};
</code></pre>
<p>The validatedObservable function will add an errors function to the
composite model which traverses the object graph and validates each
eligible property. The errors function also has a showAllMessages
function that will display an error message next to each invalid
element. The isValid function only asserts if there are any errors.</p>
<pre><code>function BookingModel() {      
    var self = this;
    
    self.contact = new ContactModel();
    self.departure = new DepartureModel();

    self.validate = function() {                           
        if (!self.isValid()) {                                         
            self.errors.showAllMessages();
        
            return false;          
        }

        return true;
    };             
}   

function DepartureModel() {
    this.street = ko.observable('').extend({ required: true });
    this.houseNumber = ko.observable('').extend({ required: true });
    this.city = ko.observable('').extend({ required: true });
    this.time = ko.observable('').extend({ required: true });            
}

function ContactModel() {
    this.firstName = ko.observable('').extend({ required: true });
    this.lastName = ko.observable('').extend({ required: true });
    this.phoneNumber = this.firstName = ko.observable('').extend({ required: true });
    this.email = ko.observable('').extend({ required: true });        
}
</code></pre>
<p>Removing that cruft results in less bulky, cheaper models.</p>
<p>If you try this example, you will notice that the model appears to be
valid even though the validation rules are clearly violated. It took me
a few minutes of browsing the source to figure out why this was
happening. When you use the group functions to validate your model, they
will by default only look at first level properties. So if you have a
composite model, you need to modify the grouping validation
configuration, and set the deep property to true.</p>
<pre><code>ko.validation.init({ grouping : { deep: true, observable: true } });
</code></pre>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="/tags/"></a></li>
							
						</ul>
					
				
			</div></div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div>2013  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>

<script>feather.replace()</script>
</body>
</html>
