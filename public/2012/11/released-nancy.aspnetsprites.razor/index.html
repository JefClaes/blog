<!DOCTYPE html>
<html>
<head><script src="/livereload.js?port=1313&mindelay=10&v=2" data-no-instant defer></script>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Released: Nancy.AspNetSprites.Razor - Jef Claes</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta itemprop="name" content="Released: Nancy.AspNetSprites.Razor">
<meta itemprop="description" content="I was setting up a web application that shows an image for each listed product on the home page. When there were a few products, this worked pretty smooth, but as the number of products (and thereby images) increased, performance degraded. The problem is that each image initiates a separate request. The solution for this problem is to reduce the number of requests by combining the images using CSS sprites. Here is an in-detail explanation of how this works.">
<meta itemprop="datePublished" content="2012-11-18T15:06:00&#43;01:00" />
<meta itemprop="dateModified" content="2012-11-18T15:06:00&#43;01:00" />
<meta itemprop="wordCount" content="657">



<meta itemprop="keywords" content="Tools,.NET,ASP.NET,Browsers,HTTP,NancyFx,Opensource," /><meta property="og:title" content="Released: Nancy.AspNetSprites.Razor" />
<meta property="og:description" content="I was setting up a web application that shows an image for each listed product on the home page. When there were a few products, this worked pretty smooth, but as the number of products (and thereby images) increased, performance degraded. The problem is that each image initiates a separate request. The solution for this problem is to reduce the number of requests by combining the images using CSS sprites. Here is an in-detail explanation of how this works." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/2012/11/released-nancy.aspnetsprites.razor/" />
<meta property="article:published_time" content="2012-11-18T15:06:00+01:00" />
<meta property="article:modified_time" content="2012-11-18T15:06:00+01:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Released: Nancy.AspNetSprites.Razor"/>
<meta name="twitter:description" content="I was setting up a web application that shows an image for each listed product on the home page. When there were a few products, this worked pretty smooth, but as the number of products (and thereby images) increased, performance degraded. The problem is that each image initiates a separate request. The solution for this problem is to reduce the number of requests by combining the images using CSS sprites. Here is an in-detail explanation of how this works."/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="http://localhost:1313/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="http://localhost:1313/css/main.css" />

        <link id="dark-scheme" rel="stylesheet" type="text/css" href="http://localhost:1313/css/dark.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="http://localhost:1313/js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="http://localhost:1313/">
				<img src="https://image.freepik.com/free-vector/young-man-head-with-beard-avatar-character_24877-36786.jpg" alt="Jef Claes" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="http://localhost:1313/">Jef Claes</a></h1>
	<div class="site-description"><p>On software and life</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/jefclaes" title="Github"><i data-feather="github"></i></a></li><li><a href="/index.xml" title="RSS"><i data-feather="rss"></i></a></li></ul>
		</nav></div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/post">All posts</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">18</span>
							<span class="rest">Nov 2012</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">Released: Nancy.AspNetSprites.Razor</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>I was setting up a web application that shows an image for each listed
product on the home page. When there were a few products, this worked
pretty smooth, but as the number of products (and thereby images)
increased, performance degraded. The problem is that each image
initiates a separate request. The solution for this problem is to reduce
the number of requests by combining the images using CSS sprites.
<a href="http://alistapart.com/articles/sprites">Here</a> is an in-detail
explanation of how this works.</p>
<p>I remembered the <a href="http://www.hanselman.com/blog/NuGetPackageOfTheWeek1ASPNETSpriteAndImageOptimization.aspx">Hanselman writing about a Nuget package which does all
the heavy lifting for
you</a>:
<a href="http://aspnet.codeplex.com/releases/view/65787">Microsoft&rsquo;s ASP.NET Sprite and Image
Optimization</a>.</p>
<blockquote>
<p>The ASP.NET Sprite and Image Optimization framework is designed to
decrease the amount of time required to request and display a page
from a web server by performing a variety of optimizations on the
page’s images. This is the fourth preview of the feature and works
with ASP.NET Web Forms 4, ASP.NET MVC 3, and ASP.NET Web Pages (Razor)
projects.</p>
</blockquote>
<p>Installing that package, it dawned on me that I wasn&rsquo;t using Mvc, nor
WebForms, but Nancy on an ASP.NET host with the Razor view engine. So
out-of-the-box, this package couldn&rsquo;t work for me.</p>
<p>I looked at the project a bit, and discovered that it would be easily
portable to Nancy (on an ASP.NET host with the Razor view engine). It
consists of three parts: AspNetSprites-Core,
AspNetSprites-WebFormsControl and AspNetSprites-MvcAndRazorHelper. I
could make use of the core package, and port the Mvc package to Nancy.
The port was pretty straightforward; I removed the Mvc dependencies, and
returned Nancy&rsquo;s IHtmlString instead of Mvc&rsquo;s IHtmlString. Note that
this all still heavily relies on ASP.NET and its infrastructure.</p>
<p>I packaged this project for
<a href="http://nuget.org/packages/Nancy.AspNetSprites.Razor">Nuget</a> yesterday,
and <a href="https://github.com/JefClaes/Nancy.AspNetSprites.Razor">the source is on
GitHub</a> (under
the MIT license).</p>
<p>Here is some documentation shaped as a how to.</p>
<p><strong>Create an Empty ASP.NET Web Application</strong><br>
**<br>
**You can use the ASP.NET Empty Web Application template.</p>
<p><strong>Install the package</strong></p>
<pre><code>PM; Install-Package Nancy.AspNetSprites.Razor
Attempting to resolve dependency 'AspNetSprites-Core (= 0.4)'.
Attempting to resolve dependency 'Nancy (= 0.13.0)'.
Attempting to resolve dependency 'Nancy.Hosting.Aspnet (= 0.13.0)'.
Attempting to resolve dependency 'Nancy.Viewengines.Razor (= 0.13.0)'.
Successfully installed 'AspNetSprites-Core 0.4'.
Successfully installed 'Nancy 0.13.0'.
Successfully installed 'Nancy.Hosting.Aspnet 0.13.0'.
Successfully installed 'Nancy.Viewengines.Razor 0.13.0'.
Successfully installed 'Nancy.AspNetSprites.Razor 0.0.2'.
Successfully added 'AspNetSprites-Core 0.4' to SpritesExample.
Successfully added 'Nancy 0.13.0' to SpritesExample.
Successfully added 'Nancy.Hosting.Aspnet 0.13.0' to SpritesExample.
Successfully added 'Nancy.Viewengines.Razor 0.13.0' to SpritesExample.
Successfully added 'Nancy.AspNetSprites.Razor 0.0.2' to SpritesExample.
</code></pre>
<p>This will add the references, alter the web.config, add an App_Sprites
folder and add the necessary conventions automatically.</p>
<p><strong>Known issue:</strong> depending on the name of your assembly, the
AppSpritesConvention might be overwritten by one of Nancy&rsquo;s conventions.
While I&rsquo;m trying to come up with a good solution, you can move the
convention to your bootstrapper.</p>
<p><strong>Add images to the App_Sprites folder</strong><br>
**<br>
**Add the images you want to make sprites for to the App_Sprites
folder. You can also make use of subfolders. In this example I added two
images: image1.jpg and image2.jpg.</p>
<p><strong>A working example</strong><br>
**<br>
**Add a simple Nancy module which returns a view named View.</p>
<pre><code>public class Module : NancyModule
{
    public Module() 
    {
        Get[&quot;/&quot;] = p =&gt; View[&quot;View&quot;];
    }
}
</code></pre>
<p>In your view, make use of the Sprite.ImportStyleSheet and the
Sprite.Image method to include the stylesheet and images.</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
    &lt;head&gt;   
        @Sprite.ImportStylesheet(&quot;~/App_Sprites&quot;)
    &lt;/head&gt;
    &lt;body&gt;
    @Sprite.Image(&quot;~/App_Sprites/image1.jpg&quot;, new Dictionary&lt;string, object&gt;()
    {
        { &quot;alt&quot;, &quot;First image&quot; }, 
        { &quot;title&quot;,&quot;First image&quot; }
    } )

    @Sprite.Image(&quot;~/App_Sprites/image2.jpg&quot;, new Dictionary&lt;string, object&gt;()
    {
        { &quot;alt&quot;, &quot;Second image&quot; }, 
        { &quot;title&quot;,&quot;Second image&quot; }
    } )
&lt;/body&gt;
</code></pre>
<p>The outputted HTML and CSS now looks like this.</p>
<pre><code>&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;   
    &lt;link href=&quot;App_Sprites/highCompat.css&quot; media=&quot;all&quot; rel=&quot;stylesheet&quot; type=&quot;text/css&quot; /&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;img alt=&quot;First image&quot; class=&quot;image1.jpg&quot; src=&quot;data:image/gif;base64,...&quot; title=&quot;First image&quot; /&gt;
    &lt;img alt=&quot;Second image&quot; class=&quot;image2.jpg&quot; src=&quot;data:image/gif;base64,...&quot; title=&quot;Second image&quot; /&gt;
&lt;/body&gt;

.image1\.jpg
{
    width:468px;
    height:315px;
    background-image:url(sprite0.png);
    background-position:0px 0px;
}
.image2\.jpg
{
    width:468px;
    height:315px;
    background-image:url(sprite0.png);
    background-position:-469px 0px;
}
</code></pre>
<p><em>I hope it will prove useful for someone in the future. Let me know if
you have any feedback or questions.</em></p>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="/tags/tools">Tools</a></li>
							
							<li><a href="/tags/.net">.NET</a></li>
							
							<li><a href="/tags/asp.net">ASP.NET</a></li>
							
							<li><a href="/tags/browsers">Browsers</a></li>
							
							<li><a href="/tags/http">HTTP</a></li>
							
							<li><a href="/tags/nancyfx">NancyFx</a></li>
							
							<li><a href="/tags/opensource">Opensource</a></li>
							
						</ul>
					
				
			</div></div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div>2012  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>

<script>feather.replace()</script>
</body>
</html>
