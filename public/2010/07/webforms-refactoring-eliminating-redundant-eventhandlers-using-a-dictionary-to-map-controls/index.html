<!DOCTYPE html>
<html>
<head><script src="/livereload.js?port=1313&mindelay=10&v=2" data-no-instant defer></script>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>WebForms refactoring: Eliminating redundant eventhandlers using a dictionary to map controls - Jef Claes</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta itemprop="name" content="WebForms refactoring: Eliminating redundant eventhandlers using a dictionary to map controls">
<meta itemprop="description" content="Last week I came across a problem which seemed trivial at first sight, but turned out to be a pretty fun refactoring challenge.
The scenarioThe real problem was a bit more complex, but for simplicity&rsquo;s sake I made this example. In this form there are three checkboxes which map with the textboxes next to them. If the checkbox gets unchecked the corresponding textboxes should be cleared.

First iterationI warn you.">
<meta itemprop="datePublished" content="2010-07-12T21:35:00&#43;02:00" />
<meta itemprop="dateModified" content="2010-07-12T21:35:00&#43;02:00" />
<meta itemprop="wordCount" content="483">



<meta itemprop="keywords" content="CodeSnippets,.NET,ASP.NET,Refactoring,Tips," /><meta property="og:title" content="WebForms refactoring: Eliminating redundant eventhandlers using a dictionary to map controls" />
<meta property="og:description" content="Last week I came across a problem which seemed trivial at first sight, but turned out to be a pretty fun refactoring challenge.
The scenarioThe real problem was a bit more complex, but for simplicity&rsquo;s sake I made this example. In this form there are three checkboxes which map with the textboxes next to them. If the checkbox gets unchecked the corresponding textboxes should be cleared.

First iterationI warn you." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://localhost:1313/2010/07/webforms-refactoring-eliminating-redundant-eventhandlers-using-a-dictionary-to-map-controls/" />
<meta property="article:published_time" content="2010-07-12T21:35:00+02:00" />
<meta property="article:modified_time" content="2010-07-12T21:35:00+02:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="WebForms refactoring: Eliminating redundant eventhandlers using a dictionary to map controls"/>
<meta name="twitter:description" content="Last week I came across a problem which seemed trivial at first sight, but turned out to be a pretty fun refactoring challenge.
The scenarioThe real problem was a bit more complex, but for simplicity&rsquo;s sake I made this example. In this form there are three checkboxes which map with the textboxes next to them. If the checkbox gets unchecked the corresponding textboxes should be cleared.

First iterationI warn you."/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="http://localhost:1313/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="http://localhost:1313/css/main.css" />

        <link id="dark-scheme" rel="stylesheet" type="text/css" href="http://localhost:1313/css/dark.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="http://localhost:1313/js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="http://localhost:1313/">
				<img src="https://image.freepik.com/free-vector/young-man-head-with-beard-avatar-character_24877-36786.jpg" alt="Jef Claes" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="http://localhost:1313/">Jef Claes</a></h1>
	<div class="site-description"><p>On software and life</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/jefclaes" title="Github"><i data-feather="github"></i></a></li><li><a href="/index.xml" title="RSS"><i data-feather="rss"></i></a></li></ul>
		</nav></div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/post">All posts</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">12</span>
							<span class="rest">Jul 2010</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">WebForms refactoring: Eliminating redundant eventhandlers using a dictionary to map controls</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>Last week I came across a problem which seemed trivial at first sight,
but turned out to be a pretty fun refactoring challenge.</p>
<p><!-- raw HTML omitted -->The scenario<!-- raw HTML omitted --></p>
<p>The real problem was a bit more complex, but for simplicity&rsquo;s sake I
made this example. In this form there are three checkboxes which map
with the textboxes next to them. If the checkbox gets unchecked the
corresponding textboxes should be cleared.</p>
<p><a href="/post/images/2010-07-12-webforms-refactoring-eliminating-redundant-eventhandlers-using-a-dictionary-to-map-controls-Example.PNG"><img src="/post/images/thumbnails/2010-07-12-webforms-refactoring-eliminating-redundant-eventhandlers-using-a-dictionary-to-map-controls-Example.PNG" alt=""></a></p>
<p><!-- raw HTML omitted -->First iteration<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->I warn you. This might make your eyes
bleed.<!-- raw HTML omitted --></p>
<pre><code>   1:  protected void chkCaseOne_CheckedChanged(object sender, EventArgs e)

   2:  {

   3:      bool isChecked = (((CheckBox)sender).Checked);

   4:   

   5:      if (!isChecked)

   6:      {

   7:          this.txtCaseOneFirst.Text = string.Empty;

   8:          this.txtCaseOneSecond.Text = string.Empty;

   9:      }

  10:  }

  11:   

  12:  protected void chkCaseTwo_CheckedChanged(object sender, EventArgs e)

  13:  {

  14:      bool isChecked = (((CheckBox)sender).Checked);

  15:   

  16:      if (!isChecked)

  17:      {

  18:          this.txtCaseTwoFirst.Text = string.Empty;

  19:          this.txtCaseTwoSecond.Text = string.Empty;

  20:      }

  21:  }

  22:   

  23:  protected void chkCaseThree_CheckedChanged(object sender, EventArgs e)

  24:  {

  25:      bool isChecked = (((CheckBox)sender).Checked);

  26:   

  27:      if (!isChecked)

  28:      {

  29:          this.txtCaseThreeFirst.Text = string.Empty;

  30:          this.txtCaseThreeSecond.Text = string.Empty;

  31:      }

  32:  }
</code></pre>
<p>Every developer should be able to see the horror in this Copy-Paste
fiesta.</p>
<p><!-- raw HTML omitted -->Second iteration<!-- raw HTML omitted --></p>
<p>The obvious next step is extracting the repeated logic into a method.</p>
<pre><code>   1:  protected void chkCaseOne_CheckedChanged(object sender, EventArgs e)

   2:  {

   3:      this.ClearTextBoxesIfCheckBoxNotChecked(

   4:          (CheckBox)sender,

   5:          new TextBox[] { this.txtCaseOneFirst, this.txtCaseOneSecond });

   6:  }

   7:   

   8:  protected void chkCaseTwo_CheckedChanged(object sender, EventArgs e)

   9:  {

  10:      this.ClearTextBoxesIfCheckBoxNotChecked(

  11:          (CheckBox)sender,

  12:          new TextBox[] { this.txtCaseTwoFirst, this.txtCaseTwoSecond });

  13:  }

  14:   

  15:  protected void chkCaseThree_CheckedChanged(object sender, EventArgs e)

  16:  {

  17:      this.ClearTextBoxesIfCheckBoxNotChecked(

  18:          (CheckBox)sender,

  19:          new TextBox[] { this.txtCaseThreeFirst, this.txtCaseThreeSecond });

  20:  }

  21:   

  22:  private void ClearTextBoxesIfCheckBoxNotChecked(CheckBox checkBox, TextBox[] textBoxes)

  23:  {

  24:      if (!checkBox.Checked)

  25:      {

  26:          foreach (TextBox textBox in textBoxes)

  27:          {

  28:              textBox.Text = string.Empty;

  29:          }

  30:      }

  31:  }
</code></pre>
<p>This is better, but I&rsquo;m still not satisfied. Those three eventhandlers
seem to be overhead, and are just cluttering my code-behind.</p>
<p><!-- raw HTML omitted -->Third and final iteration<!-- raw HTML omitted --></p>
<p>In the final iteration I get rid of the three seperate eventhandlers. I
use a dictionary to create a mapping between the checkboxes and their
corresponding textboxes. Using the eventhandlers sender I get the
matching mapping in the dictionary. Once the matching mapping is found I
extract the checkbox and its corresponding textboxes from the
keyvaluepair and apply the logic.</p>
<pre><code>   1:  protected void chkCase_CheckedChanged(object sender, EventArgs e)

   2:  {

   3:      Dictionary&lt;CheckBox, TextBox[]&gt; mappings = new Dictionary&lt;CheckBox, TextBox[]&gt;()

   4:      {

   5:          {this.chkCaseOne, new TextBox[] {this.txtCaseOneFirst, this.txtCaseOneSecond}},

   6:          {this.chkCaseTwo, new TextBox[] {this.txtCaseTwoFirst, this.txtCaseTwoSecond}},

   7:          {this.chkCaseThree, new TextBox[] {this.txtCaseThreeFirst, this.txtCaseThreeSecond}}

   8:      };

   9:   

  10:      var res = mappings.Where(map =&gt; map.Key.Equals((CheckBox)sender)).First();

  11:   

  12:      CheckBox checkBox = (CheckBox)res.Key;

  13:      TextBox[] textBoxes = (TextBox[])res.Value;

  14:   

  15:      if (!checkBox.Checked)

  16:      {

  17:          foreach (TextBox textBox in textBoxes)

  18:          {

  19:              textBox.Text = string.Empty;

  20:          }

  21:      }           

  22:  } 
</code></pre>
<p><!-- raw HTML omitted -->One more iteration?<!-- raw HTML omitted --></p>
<p>I&rsquo;m pretty satisfied with the last iteration. <!-- raw HTML omitted -->Are you?<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->You can find the follow-up
<a href="http://jclaes.blogspot.com/2010/07/follow-up-eliminating-redundant.html">here</a>.<!-- raw HTML omitted --></p>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="/tags/codesnippets">CodeSnippets</a></li>
							
							<li><a href="/tags/.net">.NET</a></li>
							
							<li><a href="/tags/asp.net">ASP.NET</a></li>
							
							<li><a href="/tags/refactoring">Refactoring</a></li>
							
							<li><a href="/tags/tips">Tips</a></li>
							
						</ul>
					
				
			</div></div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div>2010  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>

<script>feather.replace()</script>
</body>
</html>
