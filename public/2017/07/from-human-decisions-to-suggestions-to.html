<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>From human decisions, to suggestions to automated decisions - Jef Claes</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta itemprop="name" content="From human decisions, to suggestions to automated decisions">
<meta itemprop="description" content="I&rsquo;ve been wanting to share this experience for a while, but it took me a while to come up with a story and example I could use in a blog post.
I help out during the weekends in a small family run magic shop. I&rsquo;m the third generation working in the shop. My great-grandfather always hoped that his only son would follow in his footsteps as a carpenter. But at only eighteen years old, my grandfather said goodbye to the chisels and sawdust, and set out for the big city to chase his dream of becoming a world class magician.">
<meta itemprop="datePublished" content="2017-07-23T08:48:00&#43;02:00" />
<meta itemprop="dateModified" content="2017-07-23T08:48:00&#43;02:00" />
<meta itemprop="wordCount" content="1816">



<meta itemprop="keywords" content="ddd,story," /><meta property="og:title" content="From human decisions, to suggestions to automated decisions" />
<meta property="og:description" content="I&rsquo;ve been wanting to share this experience for a while, but it took me a while to come up with a story and example I could use in a blog post.
I help out during the weekends in a small family run magic shop. I&rsquo;m the third generation working in the shop. My great-grandfather always hoped that his only son would follow in his footsteps as a carpenter. But at only eighteen years old, my grandfather said goodbye to the chisels and sawdust, and set out for the big city to chase his dream of becoming a world class magician." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jefclaes.be/2017/07/from-human-decisions-to-suggestions-to.html" />
<meta property="article:published_time" content="2017-07-23T08:48:00+02:00" />
<meta property="article:modified_time" content="2017-07-23T08:48:00+02:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="From human decisions, to suggestions to automated decisions"/>
<meta name="twitter:description" content="I&rsquo;ve been wanting to share this experience for a while, but it took me a while to come up with a story and example I could use in a blog post.
I help out during the weekends in a small family run magic shop. I&rsquo;m the third generation working in the shop. My great-grandfather always hoped that his only son would follow in his footsteps as a carpenter. But at only eighteen years old, my grandfather said goodbye to the chisels and sawdust, and set out for the big city to chase his dream of becoming a world class magician."/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://jefclaes.be/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://jefclaes.be/css/main.css" />

        <link id="dark-scheme" rel="stylesheet" type="text/css" href="https://jefclaes.be/css/dark.css" />

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://jefclaes.be/js/main.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="https://jefclaes.be/">
				<img src="https://image.freepik.com/free-vector/young-man-head-with-beard-avatar-character_24877-36786.jpg" alt="Jef Claes" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="https://jefclaes.be/">Jef Claes</a></h1>
	<div class="site-description"><p>On software and life</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/jefclaes" title="Github"><i data-feather="github"></i></a></li><li><a href="https://twitter.com/jefclaes" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://www.linkedin.com/in/jefclaes" title="LinkedIn"><i data-feather="linkedin"></i></a></li><li><a href="http://feed.jefclaes.be" title="RSS"><i data-feather="rss"></i></a></li></ul>
		</nav></div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/post">All posts</a>
			</li>
			
			<li>
				<a href="/tags">Tags</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">23</span>
							<span class="rest">Jul 2017</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">From human decisions, to suggestions to automated decisions</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>I&rsquo;ve been wanting to share this experience for a while, but it took me a
while to come up with a story and example I could use in a blog post.</p>
<p>I help out during the weekends in a small family run magic shop. I&rsquo;m the
third generation working in the shop. My great-grandfather always hoped
that his only son would follow in his footsteps as a carpenter. But at
only eighteen years old, my grandfather said goodbye to the chisels and
sawdust, and set out for the big city to chase his dream of becoming a
world class magician. The first few years were tough, he was no Houdini.
He would (hardly) get by performing at kid birthday parties, weddings
and store openings. That&rsquo;s how he met my late grandmother. She worked as
a shop girl in one of the first malls that were built in the city, and
happened to show up each time my grandfather performed in one of the
stores. After getting married, having a baby (my dad) and saving every
dime they earned, my grandfather was able to rent a hole in the wall and
open up his own tiny magic shop - in that same mall. Once my dad
finished school, he worked as a middle school teacher for a few years,
giving up on that job to join his father in the family business. He
loves to tell you how he can now still teach children, without the chore
of grading their homework. I&rsquo;ve been running around and helping out in
the store since I could barely walk. I guess you can say that magic runs
in our blood.</p>
<p>Since the beginning of time, our trade has relied on secrecy. However,
due to the rise of the internet, magic is dying a slow death. Even the
greatest of tricks and illusions are challenged and destroyed in the
open by non-believers. Our craft is now reduced by many to a cheap
fairground attraction.</p>
<p>My grandfather, even after suddenly losing grandma last year, isn&rsquo;t
willing to give up on the business though. &ldquo;There will be a time when
the people need magic once more, and we will be waiting right here.&rdquo; He
decided not to see modern technology as the nemesis of magic, but rather
as a potential assistant.</p>
<p>Instead of fiddling in his study all night with a book of cards, a hat,
a scarf and the lonely rabbit, I&rsquo;ve been working with him trying to show
him what happened in technology over the last 30 years. Being a
programmer, I started by showing off some of my unfinished hobby
projects experimenting with micro controllers. I hadn&rsquo;t gotten much
further than making some LEDs blink controlled by my voice, but that was
enough to spark my grandfather&rsquo;s creativity. &ldquo;Can that chip make the
lights go out? Can it blow smoke? Can it sense if I flip it around real
fast?&rdquo; One evening, tired after brainstorming and testing ideas all
night, he told me &ldquo;being able to tell these little computers what to do
might not be magic, but a miracle&rdquo;.</p>
<p>I would like to tell you the details of what we came up with, but I&rsquo;d
have to make you disappear after I did. To make a long story short, it
was an overwhelming success. Neighbourhood magicians picked it up, and
even mere mortals thought it was a great gimmick they could show off
with. A friend of mine even told me he used our invention to pick up
girls. It wasn&rsquo;t for long before I got daily emails and tweets from all
over the world, begging me to ship our gadget their way.</p>
<p>Thanks to some lovely open source software, I was able to set up a full
blown web shop in a matter of days. While orders started rolling in, we
got a grip on how to actually produce our new product at a sufficient
pace. Shipping overseas turned out to be surprisingly easy. What we
didn&rsquo;t anticipate for was how to handle returns and refunds.</p>
<p><em>This is where the actual story starts&hellip;</em></p>
<p>When our usual customers visit the store, we take our sweet time to show
them how to perform the trick. This results in us knowing our customers
pretty well and hardly ever having anyone return an item or ask for a
refund. Admittedly, growing the same connection with our customers
online hasn&rsquo;t been a success. A lot of them lack the magician mindset.
You can&rsquo;t just buy magic, you have to put the practice in to make the
magic happen. These maladjusted expectations make for quite a few phoney
complaints.</p>
<p>Me, my dad and my grandfather in turn have been performing the chore of
handling returns and refunds. This domain of the open source shop is
very much underdeveloped. Even something as simple as looking up a
customer&rsquo;s details and order history, requires scanning multiple pages
of information or even querying the database by hand. Making a
well-informed decision takes up way more time than it should.</p>
<h3 id="a-use-case-specific-view">A use case specific view</h3>
<p>The first thing I did in an attempt to speed up this process was
building a use case specific view. I asked my dad and grandfather which
heuristics they use and which data is needed to feed those heuristics.
To get the full picture as soon as possible, I imposed the rule that
only this specific view can be used to make a decision. If a piece of
data was lacking, I would add it the same day.</p>
<p>This process was more useful than I expected. What we learned is that we
all used different heuristics, but were also victim to different biases.
For example, I learned that my grandfather used to have a Dutch
neighbour who would leave for work very early, and slam the door so
loud, it woke my grandfather up each morning. He has grown a disliking
for the Dutch ever since. When customers were Belgian, he would much
more lean towards issuing a refund, since he believes Belgians are less
likely to lie about the cause of a broken item. We also discovered that
we used different words for specific numbers. I would use &ldquo;Items
purchased sum&rdquo;, but my dad would use &ldquo;Items purchased lifetime&rdquo; to
define the total amount of money spent purchasing items. We decided on
being more explicit and making a composition of all those words.</p>
<p>I ended up with a simple screen that rendered a read model that looked
something like this.</p>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#859900">type</span> <span style="color:#cb4b16">ReadModel</span> = {
    <span style="color:#268bd2">DaysSinceItemPurchased</span> : <span style="color:#268bd2">int</span>
    <span style="color:#268bd2">ItemPrice</span> : <span style="color:#859900;font-weight:bold">decimal</span>
    <span style="color:#268bd2">ItemPurchasedSumLifetime</span> : <span style="color:#859900;font-weight:bold">decimal</span>
    <span style="color:#268bd2">RefundedToPurchasedItemsRatio</span> : <span style="color:#859900;font-weight:bold">decimal</span>
    <span style="color:#268bd2">CustomerId</span> : <span style="color:#859900;font-weight:bold">string</span>
    <span style="color:#268bd2">CustomerName</span> : <span style="color:#859900;font-weight:bold">string</span>
    <span style="color:#268bd2">CustomerCity</span> : <span style="color:#859900;font-weight:bold">string</span>
    <span style="color:#268bd2">CustomerCountryCode</span> : <span style="color:#859900;font-weight:bold">string</span>
}
</code></pre></div><p><a href="/post/images/2017-07-23-from-human-decisions-to-suggestions-to-automated-decisions-readmodel.PNG"><img src="/post/images/thumbnails/2017-07-23-from-human-decisions-to-suggestions-to-automated-decisions-readmodel.PNG" alt=""></a></p>
<p>Based on heuristics in the head and a snapshot of information available in the
world, we would make a decision and click a button to execute a specific
command.</p>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#859900">type</span> <span style="color:#cb4b16">Command</span> =
    | <span style="color:#268bd2">IssueRefund</span>
    | <span style="color:#268bd2">IssuePartialRefund</span>
    | <span style="color:#268bd2">AwardCoupon</span>
    | <span style="color:#268bd2">ShipReplacement</span>
    | <span style="color:#268bd2">DenyRefund</span>
    | <span style="color:#268bd2">DeferDecision</span>

<span style="color:#859900">type</span> <span style="color:#cb4b16">Snapshot</span> = {
    <span style="color:#268bd2">SnapshotId</span> : <span style="color:#859900;font-weight:bold">string</span>
    <span style="color:#268bd2">Value</span> : <span style="color:#268bd2">ReadModel</span>
}

<span style="color:#859900">type</span> <span style="color:#cb4b16">Decision</span> = {
    <span style="color:#268bd2">BasedOnSnapshotId</span> : <span style="color:#859900;font-weight:bold">string</span>
    <span style="color:#268bd2">Command</span> : <span style="color:#268bd2">Command</span>
    <span style="color:#268bd2">MadeBy</span> : <span style="color:#859900;font-weight:bold">string</span>
}

<span style="color:#859900">type</span> <span style="color:#cb4b16">MakeDecision</span> = <span style="color:#268bd2">Snapshot</span> -&gt; <span style="color:#268bd2">Decision</span>

<span style="color:#859900">let</span> <span style="color:#268bd2">makeHumanDecision</span> <span style="color:#268bd2">by</span> : <span style="color:#268bd2">MakeDecision</span> =
    <span style="color:#93a1a1;font-style:italic">// Heuristics in the head, fed by knowledge in the world
</span><span style="color:#93a1a1;font-style:italic"></span>    <span style="color:#859900">fun</span> <span style="color:#268bd2">snapshot</span> -&gt;
        {
            <span style="color:#268bd2">BasedOnSnapshotId</span> = <span style="color:#268bd2">snapshot</span>.<span style="color:#268bd2">SnapshotId</span>
            <span style="color:#268bd2">Command</span> = <span style="color:#268bd2">IssueRefund</span>
            <span style="color:#268bd2">MadeBy</span> = <span style="color:#268bd2">by</span>
        }
</code></pre></div><h3 id="making-suggestions">Making suggestions</h3>
<p>By now, I had gotten quite interested in this domain. Each day I would
go over all of the decisions and see whether I understood why a decision
was made. I would call the shop each time I didn&rsquo;t understand and
scribble down notes whenever I discovered a new implicit rule. In the
meanwhile, I started experimenting with codifying these rules to make
automated decisions, but when I ran the older snapshots through my
routine the results were not 100% there yet. Instead of making automated
decisions, I switched to making suggestions instead.</p>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#859900">type</span> <span style="color:#cb4b16">Suggestion</span> = {
    <span style="color:#268bd2">Command</span> : <span style="color:#268bd2">Command</span>
    <span style="color:#268bd2">Confidence</span> : <span style="color:#268bd2">int</span>
}

<span style="color:#859900">type</span> <span style="color:#cb4b16">Suggestions</span> = {
    <span style="color:#268bd2">BasedOnSnapshotId</span> : <span style="color:#859900;font-weight:bold">string</span>
    <span style="color:#268bd2">Options</span> : <span style="color:#268bd2">Suggestion</span> <span style="color:#268bd2">seq</span>
}

<span style="color:#859900">type</span> <span style="color:#cb4b16">MakeSuggestion</span> = <span style="color:#268bd2">Snapshot</span> -&gt; <span style="color:#268bd2">Suggestions</span>

<span style="color:#859900">let</span> <span style="color:#268bd2">machineMakesSuggestions</span> <span style="color:#268bd2">snapshot</span> =
    <span style="color:#859900">let</span> <span style="color:#268bd2">returnWindowInDays</span> = <span style="color:#268bd2">14</span>
    <span style="color:#859900">let</span> <span style="color:#268bd2">itemInReturnWindow</span> = <span style="color:#268bd2">snapshot</span>.<span style="color:#268bd2">Value</span>.<span style="color:#268bd2">DaysSinceItemPurchased</span> &lt;= <span style="color:#268bd2">returnWindowInDays</span>

    <span style="color:#859900">let</span> <span style="color:#268bd2">options</span> =
        <span style="color:#859900">if</span> <span style="color:#268bd2">itemInReturnWindow</span> <span style="color:#859900">then</span>
            [
                { <span style="color:#268bd2">Command</span> = <span style="color:#268bd2">ShipReplacement</span>; <span style="color:#268bd2">Confidence</span> = <span style="color:#268bd2">51</span> }
                { <span style="color:#268bd2">Command</span> = <span style="color:#268bd2">IssueRefund</span>; <span style="color:#268bd2">Confidence</span> = <span style="color:#268bd2">49</span> }
		{ <span style="color:#268bd2">Command</span> = <span style="color:#268bd2">DenyRefund</span>; <span style="color:#268bd2">Confidence</span> = <span style="color:#268bd2">0</span> }
                { <span style="color:#268bd2">Command</span> = <span style="color:#268bd2">AwardCoupon</span>; <span style="color:#268bd2">Confidence</span> = <span style="color:#268bd2">0</span> }
                { <span style="color:#268bd2">Command</span> = <span style="color:#268bd2">IssuePartialRefund</span>; <span style="color:#268bd2">Confidence</span> = <span style="color:#268bd2">0</span> }
            ]
        <span style="color:#859900">else</span>
            [
                { <span style="color:#268bd2">Command</span> = <span style="color:#268bd2">DenyRefund</span>; <span style="color:#268bd2">Confidence</span> = <span style="color:#268bd2">50</span> }
                { <span style="color:#268bd2">Command</span> = <span style="color:#268bd2">AwardCoupon</span>; <span style="color:#268bd2">Confidence</span> = <span style="color:#268bd2">30</span> }
                { <span style="color:#268bd2">Command</span> = <span style="color:#268bd2">IssuePartialRefund</span>; <span style="color:#268bd2">Confidence</span> = <span style="color:#268bd2">10</span> }
                { <span style="color:#268bd2">Command</span> = <span style="color:#268bd2">ShipReplacement</span>; <span style="color:#268bd2">Confidence</span> = <span style="color:#268bd2">10</span> }
                { <span style="color:#268bd2">Command</span> = <span style="color:#268bd2">IssueRefund</span>; <span style="color:#268bd2">Confidence</span> = <span style="color:#268bd2">0</span> }
            ]

    { <span style="color:#268bd2">BasedOnSnapshotId</span> = <span style="color:#268bd2">snapshot</span>.<span style="color:#268bd2">SnapshotId</span>; <span style="color:#268bd2">Options</span> = <span style="color:#268bd2">options</span> }
</code></pre></div><p>I rendered these suggestions on top of the existing view and observed
the decisions that were made.</p>
<p><a href="/post/images/2017-07-23-from-human-decisions-to-suggestions-to-automated-decisions-suggestions.PNG"><img src="/post/images/thumbnails/2017-07-23-from-human-decisions-to-suggestions-to-automated-decisions-suggestions.PNG" alt=""></a></p>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#859900">type</span> <span style="color:#cb4b16">PickSuggestion</span> = <span style="color:#268bd2">Suggestions</span> -&gt; <span style="color:#268bd2">Decision</span>

<span style="color:#859900">let</span> <span style="color:#268bd2">humanPicksSuggestion</span> <span style="color:#268bd2">by</span> : <span style="color:#268bd2">PickSuggestion</span> =	
    <span style="color:#859900">fun</span> <span style="color:#268bd2">suggestions</span> -&gt;
        {
            <span style="color:#268bd2">BasedOnSnapshotId</span> = <span style="color:#268bd2">suggestions</span>.<span style="color:#268bd2">BasedOnSnapshotId</span>
            <span style="color:#268bd2">Command</span> = <span style="color:#268bd2">IssueRefund</span>
            <span style="color:#268bd2">MadeBy</span> = <span style="color:#268bd2">by</span>
        }
</code></pre></div><p>My partners in crime were quite ecstatic with this new feature. They had
a bit more room to breathe and could spend more time doing things they
liked.</p>
<p>After observing and comparing the suggestions with the decisions made, I
kept tweaking the routine a bit more. I got close but I felt as if I
wasn&rsquo;t quite there yet.</p>
<h3 id="automating-decisions">Automating decisions</h3>
<p>It was my grandfather who eventually pushed me to fully automate
making these decisions. He said &ldquo;I almost always find myself picking the
first option. It&rsquo;s fine if the machine is a bit off now and then. Just
defer decisions and call in a human when the machine is not confident
enough.&rdquo; How can I question my grandfather&rsquo;s wisdom? And so this
happened&hellip;</p>
<div class="highlight"><pre style="color:#586e75;background-color:#eee8d5;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#859900">let</span> <span style="color:#268bd2">machinePicksSuggestion</span> : <span style="color:#268bd2">PickSuggestion</span> =
    <span style="color:#859900">fun</span> <span style="color:#268bd2">suggestions</span> -&gt;
        <span style="color:#859900">let</span> <span style="color:#268bd2">confidenceTreshold</span> = <span style="color:#268bd2">50</span>

        <span style="color:#859900">let</span> <span style="color:#268bd2">command</span> =
            <span style="color:#268bd2">suggestions</span>.<span style="color:#268bd2">Options</span>
            |&gt; <span style="color:#268bd2">Seq</span>.<span style="color:#268bd2">filter</span> (<span style="color:#859900">fun</span> <span style="color:#268bd2">x</span> -&gt; <span style="color:#268bd2">x</span>.<span style="color:#268bd2">Confidence</span> &gt;= <span style="color:#268bd2">confidenceTreshold</span>)
            |&gt; <span style="color:#268bd2">Seq</span>.<span style="color:#268bd2">sortByDescending</span> (<span style="color:#859900">fun</span> <span style="color:#268bd2">x</span> -&gt; <span style="color:#268bd2">x</span>.<span style="color:#268bd2">Confidence</span>)
            |&gt; <span style="color:#268bd2">Seq</span>.<span style="color:#268bd2">map</span> (<span style="color:#859900">fun</span> <span style="color:#268bd2">x</span> -&gt; <span style="color:#268bd2">x</span>.<span style="color:#268bd2">Command</span>)
            |&gt; <span style="color:#268bd2">withFallbackTo</span> <span style="color:#268bd2">DeferDecision</span>
            |&gt; <span style="color:#268bd2">Seq</span>.<span style="color:#268bd2">head</span>

        {
            <span style="color:#268bd2">BasedOnSnapshotId</span> =  <span style="color:#268bd2">suggestions</span>.<span style="color:#268bd2">BasedOnSnapshotId</span>
            <span style="color:#268bd2">Command</span> = <span style="color:#268bd2">command</span>
            <span style="color:#268bd2">MadeBy</span> = <span style="color:#2aa198">&#34;Machine&#34;</span>
        }
</code></pre></div><h3 id="from-human-decisions-to-suggestions-to-automated-decisions">From human decisions, to suggestions, to automated decisions</h3>
<p>With that, we&rsquo;ve come full circle. I&rsquo;m happy to report that my dad,
grandfather and I are back to spending more time in my grandfather&rsquo;s
study coming up with new tricks.</p>
<p>I regularly have a look at the data to check for anomalies and to tweak
the routine a bit further. But even that is taking up less and less
time. To be fair, I didn&rsquo;t invest in a full blown test suite even though
this small routine has grown into 200 lines of code. I find much relief
in the fact that when I replay past decisions, I hardly ever find a
regression.</p>
<p>Maybe if we invent another popular trick like this one, we will acquire
enough data to let the machine do the learning for me. For now, it&rsquo;s
automagical enough.</p>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="/tags/ddd">ddd</a></li>
							
							<li><a href="/tags/story">story</a></li>
							
						</ul>
					
				
			</div></div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div>2017  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-6239073-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
